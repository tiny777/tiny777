

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://resource.tinychen.com/logos.png">
  <link rel="icon" href="https://resource.tinychen.com/logos.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="TinyChen">
  <meta name="keywords" content="">
  
    <meta name="description" content="本文主要介绍PowerDNS的主要特性和初始化安装的配置方法，侧重点是对复杂程度相对较高PowerDNS Authoritative Server进行介绍，同时会夹杂部分PowerDNS-Recursor的初始化安装和配置。">
<meta property="og:type" content="article">
<meta property="og:title" content="PowerDNS篇1-简介和安装">
<meta property="og:url" content="https://tinychen.com/20210224-dns-02-pdns01-pdns-auth-and-rec-introduction/index.html">
<meta property="og:site_name" content="TinyChen&#39;s Studio - 互联网技术学习工作经验分享">
<meta property="og:description" content="本文主要介绍PowerDNS的主要特性和初始化安装的配置方法，侧重点是对复杂程度相对较高PowerDNS Authoritative Server进行介绍，同时会夹杂部分PowerDNS-Recursor的初始化安装和配置。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://resource.tinychen.com/20210111105305s.jpg">
<meta property="article:published_time" content="2021-02-24T03:00:00.000Z">
<meta property="article:modified_time" content="2021-02-24T03:00:00.000Z">
<meta property="article:author" content="TinyChen">
<meta property="article:tag" content="dns">
<meta property="article:tag" content="powerdns">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://resource.tinychen.com/20210111105305s.jpg">
  
  
  <title>PowerDNS篇1-简介和安装 - TinyChen&#39;s Studio - 互联网技术学习工作经验分享</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/dracula.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/css/fluid-extention.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"tinychen.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":30,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"7a96963a1145ac7fde1442d739a11ffd","google":"UA-166769908-1","gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="TinyChen's Studio - 互联网技术学习工作经验分享" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>TinyChen</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://resource.tinychen.com/20210111105305.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="PowerDNS篇1-简介和安装">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-02-24 11:00" pubdate>
        February 24, 2021 am
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      13k 字
    </span>
  

  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">PowerDNS篇1-简介和安装</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：February 24, 2021 am
                
              </p>
            
            <div class="markdown-body">
              <p>本文主要介绍PowerDNS的主要特性和初始化安装的配置方法，侧重点是对复杂程度相对较高<code>PowerDNS Authoritative Server</code>进行介绍，同时会夹杂部分<code>PowerDNS-Recursor</code>的初始化安装和配置。</p>
<span id="more"></span>

<h1 id="1、PowerDNS简介"><a href="#1、PowerDNS简介" class="headerlink" title="1、PowerDNS简介"></a>1、PowerDNS简介</h1><p>PowerDNS（PDNS）成立于20世纪90年代末，是开源DNS软件、服务和支持的主要供应商，它们提供的<strong>权威认证DNS服务器</strong>和<strong>递归认证DNS服务器</strong>都是100%开源的软件，同时也和红帽等开源方案提供商一样提供了付费的技术支持版本。同时官方表示为了避免和软件使用者出现竞争，他们只提供服务支持而不提供DNS托管服务。</p>
<blockquote>
<p>Our <a target="_blank" rel="noopener" href="https://www.powerdns.com/auth.html">Authoritative Server</a>, <a target="_blank" rel="noopener" href="https://www.powerdns.com/recursor.html">Recursor</a> and <a target="_blank" rel="noopener" href="http://www.dnsdist.org/">dnsdist</a> products are <strong><a target="_blank" rel="noopener" href="https://www.powerdns.com/opensource.html">100% open source</a></strong>. For the service provider market, OX also sells the <a target="_blank" rel="noopener" href="https://www.open-xchange.com/portfolio/ox-powerdns/">PowerDNS Platform</a> which builds on our Open Source products to deliver an integrated DNS solution with 24/7 support and includes features as parental control, malware filtering, automated attack mitigation, and long-term query logging &amp; searching.</p>
</blockquote>
<p>熟悉DNS工作原理的同学可以大致地将DNS记录的查询分为两种：<strong>查询本地缓存</strong>和<strong>向上递归查询</strong>。和其他的如BIND、dnsmasq等将这些功能集成到一起的DNS软件不同，PowerDNS将其一分为二，分为了<code>PowerDNS Authoritative Server</code>和<code>PowerDNS Recursor</code>，分别对应这两种主要的需求，而我们常说的<code>pdns</code>指的就是<code>PowerDNS Authoritative Server (后面简称PDNS Auth)</code>，主要用途就是作为<strong>权威域名服务器</strong>，当然也可以作为普通的DNS服务器提供DNS查询功能。</p>
<p><img src="https://resource.tinychen.com/20200417112013.png" srcset="/img/loading.gif" lazyload></p>
<p>对于PowerDNS-Recursor，PowerDNS官网介绍其是一个<strong>内置脚本能力</strong>的高性能的<strong>DNS递归查询</strong>服务器，并且已经为一亿五千万个互联网连接提供支持。</p>
<blockquote>
<p>The PowerDNS Recursor is a high-performance DNS recursor with built-in scripting capabilities. It is known to power the resolving needs of over 150 million internet connections.</p>
</blockquote>
<p>PowerDNS-Recursor(以下简称pdns-rec)的官方文档可以点击<a target="_blank" rel="noopener" href="https://doc.powerdns.com/recursor/index.html">这里</a>查看。官方指的内置脚本能力是指在4.0.0版本之后的配置文件里面添加了对lua脚本的支持。</p>
<h1 id="2、PowerDNS安装"><a href="#2、PowerDNS安装" class="headerlink" title="2、PowerDNS安装"></a>2、PowerDNS安装</h1><h2 id="2-1-PowerDNS-Authoritative-Server安装"><a href="#2-1-PowerDNS-Authoritative-Server安装" class="headerlink" title="2.1 PowerDNS Authoritative Server安装"></a>2.1 PowerDNS Authoritative Server安装</h2><p>这里我们还是使用经典的CentOS7系统进行安装测试，系统的相关版本和内核信息如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ lsb_release -a<br>LSB Version:    :core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarch<br>Distributor ID: CentOS<br>Description:    CentOS Linux release 7.9.2009 (Core)<br>Release:        7.9.2009<br>Codename:       Core<br>$ uname -r<br>3.10.0-1160.11.1.el7.x86_64<br></code></pre></div></td></tr></table></figure>

<p>pdns对主流的操作系统都有着较好的支持，在centos上面可以直接通过repo仓库来安装，红帽系的Linux可以通过epel源，monshouwer提供的第三方源和powerdns官方源三种源来进行安装。</p>
<blockquote>
<p>On RedHat based systems there are 3 options to install PowerDNS, from <a target="_blank" rel="noopener" href="https://fedoraproject.org/wiki/EPEL">EPEL</a>, the <a target="_blank" rel="noopener" href="https://www.monshouwer.eu/download/3rd_party/pdns/">repository from Kees Monshouwer</a> or from <a target="_blank" rel="noopener" href="https://repo.powerdns.com/">the PowerDNS repositories</a>:</p>
</blockquote>
<p>使用epel源来进行安装的话可能会导致无法安装最新版本</p>
<p><img src="https://resource.tinychen.com/20210118145131.png" srcset="/img/loading.gif" lazyload></p>
<p>如果网络条件允许的话，最好的办法是直接通过官方的<a target="_blank" rel="noopener" href="https://repo.powerdns.com/">repo源</a>来进行安装，如果使用的是master源，则可以安装到最新的测试版本：</p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">yum install epel-release yum-plugin-priorities<br>curl -o <span class="hljs-regexp">/etc/yum</span>.repos.d<span class="hljs-regexp">/powerdns-auth-master.repo https:/</span><span class="hljs-regexp">/repo.powerdns.com/</span>repo-files/centos-auth-master.repo<br>yum install pdns<br>yum install pdns-backend-<span class="hljs-variable">$backend</span><br></code></pre></div></td></tr></table></figure>

<p><img src="https://resource.tinychen.com/20210118145142.png" srcset="/img/loading.gif" lazyload></p>
<p>这里我们使用最新的稳定版4.4版本进行安装，<code>backend</code>这里我们选择<code>pdns-backend-mysql</code></p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">yum install epel-release yum-plugin-priorities<br>curl -o <span class="hljs-regexp">/etc/yum</span>.repos.d<span class="hljs-regexp">/powerdns-auth-44.repo https:/</span><span class="hljs-regexp">/repo.powerdns.com/</span>repo-files/centos-auth-<span class="hljs-number">44</span>.repo<br>yum install pdns<br>yum install pdns-backend-<span class="hljs-variable">$backend</span><br></code></pre></div></td></tr></table></figure>

<p><img src="https://resource.tinychen.com/20210118145147.png" srcset="/img/loading.gif" lazyload></p>
<blockquote>
<p>请注意对于某些软件包源，bind backend作为基本pdns软件包的一部分提供，并且没有单独的pdns-backend-bind软件包。</p>
</blockquote>
<h2 id="2-2-PowerDNS-Recursor安装"><a href="#2-2-PowerDNS-Recursor安装" class="headerlink" title="2.2 PowerDNS-Recursor安装"></a>2.2 PowerDNS-Recursor安装</h2><p>这里我们还是使用经典的CentOS7系统进行安装测试，系统的相关版本和内核信息如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">[root@tiny-cloud /home]<span class="hljs-comment"># lsb_release -a</span><br>LSB Version:    :core-4.1-amd64:core-4.1-noarch:cxx-4.1-amd64:cxx-4.1-noarch:desktop-4.1-amd64:desktop-4.1-noarch:languages-4.1-amd64:languages-4.1-noarch:printing-4.1-amd64:printing-4.1-noarch<br>Distributor ID: CentOS<br>Description:    CentOS Linux release 7.9.2009 (Core)<br>Release:        7.9.2009<br>Codename:       Core<br>[root@tiny-cloud /home]<span class="hljs-comment"># uname -r</span><br>3.10.0-1160.24.1.el7.x86_64<br></code></pre></div></td></tr></table></figure>

<p>pdns对主流的操作系统都有着较好的支持，在红帽系和CentOS系相关的发行版本上面可以之间通过epel源来进行安装，不过使用epel源来进行安装的话可能会导致无法安装最新版本。</p>
<blockquote>
<p>On Red Hat, CentOS and related distributions, ensure that <a target="_blank" rel="noopener" href="https://fedoraproject.org/wiki/EPEL">EPEL</a> is available. To install the PowerDNS Recursor, run <code>yum install pdns-recursor</code> as root.</p>
</blockquote>
<p><img src="https://resource.tinychen.com/20210430141702.png" srcset="/img/loading.gif" lazyload></p>
<p>如果网络条件允许的话，最好的办法是直接通过官方的<a target="_blank" rel="noopener" href="https://repo.powerdns.com/">repo源</a>来进行安装，如果使用的是master分支的repo源，则可以安装到最新的测试版本。官方表示master存储库对应的是他们在<a target="_blank" rel="noopener" href="https://github.com/PowerDNS/pdns">github</a>上面正在开发的master分支。</p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">yum install epel-release yum-plugin-priorities &amp;&amp;<br>curl -o <span class="hljs-regexp">/etc/yum</span>.repos.d<span class="hljs-regexp">/powerdns-rec-master.repo https:/</span><span class="hljs-regexp">/repo.powerdns.com/</span>repo-files/centos-rec-master.repo &amp;&amp;<br>yum install pdns-recursor<br></code></pre></div></td></tr></table></figure>

<p><img src="https://resource.tinychen.com/20210430143317.png" srcset="/img/loading.gif" lazyload></p>
<p>当然我们也可以通过官方提供的不同版本yum源来安装对应版本的pdns，不同的版本分支对应的支持时间也是不一样的，官方表示在对应版本的生命周期结束之后，对应的仓库也不会再提供支持，pdns-rec的EOL信息可以点击<a target="_blank" rel="noopener" href="https://doc.powerdns.com/recursor/appendices/EOL.html">这里</a>查看。由于目前4.5.x版本还处于rc阶段，因此这里我们还是安装最新的稳定版本4.4.x版本。</p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">yum install epel-release yum-plugin-priorities &amp;&amp;<br>curl -o <span class="hljs-regexp">/etc/yum</span>.repos.d<span class="hljs-regexp">/powerdns-rec-44.repo https:/</span><span class="hljs-regexp">/repo.powerdns.com/</span>repo-files/centos-rec-<span class="hljs-number">44</span>.repo &amp;&amp;<br>yum install pdns-recursor<br></code></pre></div></td></tr></table></figure>

<p><img src="https://resource.tinychen.com/20210430143305.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="3、pdns-auth的mysql安装配置"><a href="#3、pdns-auth的mysql安装配置" class="headerlink" title="3、pdns-auth的mysql安装配置"></a>3、pdns-auth的mysql安装配置</h1><h2 id="3-1-安装mysql"><a href="#3-1-安装mysql" class="headerlink" title="3.1 安装mysql"></a>3.1 安装mysql</h2><p>pdns对于mysql的版本和安装方式并没有什么特殊的要求，个人推荐版本在5.7+或者8.0+都可以，这里使用yum安装8.0版本的mysql。</p>
<p>最新版的mysql的repo文件我们可以直接前往官网下载：<code>https://dev.mysql.com/downloads/repo/yum/</code></p>
<blockquote>
<p>如果需要使用5.7的版本可以到这里下载</p>
<figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> http://repo.mysql.com/mysql<span class="hljs-number">57</span>-community-release-el<span class="hljs-number">7</span>-<span class="hljs-number">9</span>.noarch.rpm<br></code></pre></div></td></tr></table></figure>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ rpm -ivh mysql80-community-release-el7-3.noarch.rpm<br>$ yum update<br>$ yum install mysql-server<br>$ mysqladmin --version<br>mysqladmin  Ver 8.0.23 <span class="hljs-keyword">for</span> Linux on x86_64 (MySQL Community Server - GPL)<br><br><span class="hljs-comment"># MYSQL8的初始密码可以在log中查看</span><br>$ grep <span class="hljs-string">&#x27;temporary password&#x27;</span> /var/<span class="hljs-built_in">log</span>/mysqld.log<br>$ mysql -u root -p<br></code></pre></div></td></tr></table></figure>

<h2 id="3-2-创建用户"><a href="#3-2-创建用户" class="headerlink" title="3.2 创建用户"></a>3.2 创建用户</h2><p>接下来需要进行基本的数据库操作，给pdns创建对应的数据库和用户并简单设置相关权限：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">-- 修改密码<br>ALTER user &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;你的新密码&#x27;;<br>-- 注意这里的&#x27;localhost&#x27;也有可能是别的参数，具体可以通过下面这条命令来进行查询：<br>select user, host, authentication_string, plugin from mysql.user;<br><br>-- 创建一个mysql的用户名为powerdns，只能本机登录<br>-- 创建一个mysql的数据库名为powerdns，并允许powerdns用户访问<br>CREATE USER &#x27;powerdns&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;你的新密码&#x27;;<br>CREATE DATABASE powerdns;<br>GRANT ALL ON powerdns.* TO &#x27;powerdns&#x27;@&#x27;localhost&#x27;;<br>FLUSH PRIVILEGES;<br><br>-- 对于MYSQL8需要额外指定加密方式避免ERROR 2059 (HY000)的问题<br>ALTER USER &#x27;powerdns&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;你的新密码&#x27;;<br></code></pre></div></td></tr></table></figure>

<h2 id="3-3-创建数据表"><a href="#3-3-创建数据表" class="headerlink" title="3.3 创建数据表"></a>3.3 创建数据表</h2><p>创建数据表的操作完全按照<a target="_blank" rel="noopener" href="https://doc.powerdns.com/authoritative/backends/generic-mysql.html#default-schema">官方的文档</a>进行，有特殊需要的也可以根据实际情况进行修改：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">CREATE TABLE domains (<br>  id                    INT AUTO_INCREMENT,<br>  name                  VARCHAR(255) NOT NULL,<br>  master                VARCHAR(128) DEFAULT NULL,<br>  last_check            INT DEFAULT NULL,<br>  type                  VARCHAR(6) NOT NULL,<br>  notified_serial       INT UNSIGNED DEFAULT NULL,<br>  account               VARCHAR(40) CHARACTER SET &#x27;utf8&#x27; DEFAULT NULL,<br>  PRIMARY KEY (id)<br>) Engine=InnoDB CHARACTER SET &#x27;latin1&#x27;;<br><br>CREATE UNIQUE INDEX name_index ON domains(name);<br><br><br>CREATE TABLE records (<br>  id                    BIGINT AUTO_INCREMENT,<br>  domain_id             INT DEFAULT NULL,<br>  name                  VARCHAR(255) DEFAULT NULL,<br>  type                  VARCHAR(10) DEFAULT NULL,<br>  content               VARCHAR(64000) DEFAULT NULL,<br>  ttl                   INT DEFAULT NULL,<br>  prio                  INT DEFAULT NULL,<br>  disabled              TINYINT(1) DEFAULT 0,<br>  ordername             VARCHAR(255) BINARY DEFAULT NULL,<br>  auth                  TINYINT(1) DEFAULT 1,<br>  PRIMARY KEY (id)<br>) Engine=InnoDB CHARACTER SET &#x27;latin1&#x27;;<br><br>CREATE INDEX nametype_index ON records(name,type);<br>CREATE INDEX domain_id ON records(domain_id);<br>CREATE INDEX ordername ON records (ordername);<br><br><br>CREATE TABLE supermasters (<br>  ip                    VARCHAR(64) NOT NULL,<br>  nameserver            VARCHAR(255) NOT NULL,<br>  account               VARCHAR(40) CHARACTER SET &#x27;utf8&#x27; NOT NULL,<br>  PRIMARY KEY (ip, nameserver)<br>) Engine=InnoDB CHARACTER SET &#x27;latin1&#x27;;<br><br><br>CREATE TABLE comments (<br>  id                    INT AUTO_INCREMENT,<br>  domain_id             INT NOT NULL,<br>  name                  VARCHAR(255) NOT NULL,<br>  type                  VARCHAR(10) NOT NULL,<br>  modified_at           INT NOT NULL,<br>  account               VARCHAR(40) CHARACTER SET &#x27;utf8&#x27; DEFAULT NULL,<br>  comment               TEXT CHARACTER SET &#x27;utf8&#x27; NOT NULL,<br>  PRIMARY KEY (id)<br>) Engine=InnoDB CHARACTER SET &#x27;latin1&#x27;;<br><br>CREATE INDEX comments_name_type_idx ON comments (name, type);<br>CREATE INDEX comments_order_idx ON comments (domain_id, modified_at);<br><br><br>CREATE TABLE domainmetadata (<br>  id                    INT AUTO_INCREMENT,<br>  domain_id             INT NOT NULL,<br>  kind                  VARCHAR(32),<br>  content               TEXT,<br>  PRIMARY KEY (id)<br>) Engine=InnoDB CHARACTER SET &#x27;latin1&#x27;;<br><br>CREATE INDEX domainmetadata_idx ON domainmetadata (domain_id, kind);<br><br><br>CREATE TABLE cryptokeys (<br>  id                    INT AUTO_INCREMENT,<br>  domain_id             INT NOT NULL,<br>  flags                 INT NOT NULL,<br>  active                BOOL,<br>  published             BOOL DEFAULT 1,<br>  content               TEXT,<br>  PRIMARY KEY(id)<br>) Engine=InnoDB CHARACTER SET &#x27;latin1&#x27;;<br><br>CREATE INDEX domainidindex ON cryptokeys(domain_id);<br><br><br>CREATE TABLE tsigkeys (<br>  id                    INT AUTO_INCREMENT,<br>  name                  VARCHAR(255),<br>  algorithm             VARCHAR(50),<br>  secret                VARCHAR(255),<br>  PRIMARY KEY (id)<br>) Engine=InnoDB CHARACTER SET &#x27;latin1&#x27;;<br><br>CREATE UNIQUE INDEX namealgoindex ON tsigkeys(name, algorithm);<br></code></pre></div></td></tr></table></figure>

<h1 id="4、pdns配置mysql"><a href="#4、pdns配置mysql" class="headerlink" title="4、pdns配置mysql"></a>4、pdns配置mysql</h1><h2 id="4-1-mysql-相关配置"><a href="#4-1-mysql-相关配置" class="headerlink" title="4.1 mysql 相关配置"></a>4.1 mysql 相关配置</h2><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># gmysql-host</span><br><span class="hljs-comment"># 需要连接的mysql的IP地址，和gmysql-socket变量互斥</span><br><br><span class="hljs-comment"># gmysql-port</span><br><span class="hljs-comment"># 需要连接的mysql的端口号，默认是3306</span><br><br><span class="hljs-comment"># gmysql-socket</span><br><span class="hljs-comment"># 需要连接的mysql的UNIX socket地址，和gmysql-host互斥</span><br><br><span class="hljs-comment"># gmysql-dbname</span><br><span class="hljs-comment"># 需要连接的数据库，默认：powerdns</span><br><br><span class="hljs-comment"># gmysql-user</span><br><span class="hljs-comment"># 连接数据库的用户名，默认：powerdns</span><br><br><span class="hljs-comment"># gmysql-group</span><br><span class="hljs-comment"># 连接数据库的组，默认：client</span><br><br><span class="hljs-comment"># gmysql-password</span><br><span class="hljs-comment"># 连接数据库的用户的密码</span><br><br><span class="hljs-comment"># gmysql-dnssec</span><br><span class="hljs-comment"># 是否启用dnssec功能，默认：no</span><br><br><span class="hljs-comment"># gmysql-innodb-read-committed</span><br><span class="hljs-comment"># 使用InnoDB的READ-COMMITTED事务隔离，默认：yes</span><br><br><span class="hljs-comment"># gmysql-ssl</span><br><span class="hljs-comment"># 是否开启SSL支持，默认：no</span><br><br><span class="hljs-comment"># gmysql-timeout</span><br><span class="hljs-comment"># 尝试读取数据库的超时时间，0为禁用，默认：10</span><br><br><span class="hljs-comment"># gmysql-thread-cleanup</span><br><span class="hljs-comment"># 对于一些老旧版本的MySQL/MariaDB（比如RHEL7内置的版本）会出现内存泄露的问题，除非应用程序明确向该库报告每个线程的结束。启用gmysql-thread-cleanup告诉PowerDNS每当线程结束时就调用mysql_thread_end（）。</span><br><span class="hljs-comment"># 只有当确定自己需要开启这个功能的时候再开启，详情可以查看https://github.com/PowerDNS/pdns/issues/6231.</span><br></code></pre></div></td></tr></table></figure>

<h2 id="4-2-pdns-conf配置"><a href="#4-2-pdns-conf配置" class="headerlink" title="4.2 pdns.conf配置"></a>4.2 pdns.conf配置</h2><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ cat /etc/pdns/pdns.conf<br>api=yes<br>api-key=你的API-KEY<br>config-dir=/etc/pdns<br>write-pid=yes<br><br>daemon=no<br>guardian=no<br><br>launch=gmysql<br>gmysql-host=localhost<br>gmysql-port=3306<br>gmysql-dbname=你的数据库名<br>gmysql-user=你的用户名<br>gmysql-password=你的密码<br><br>log-dns-details=yes<br>log-dns-queries=yes<br>log-timestamp=yes<br>loglevel=9<br>logging-facility=0<br>log-timestamp=yes<br><br>setgid=root<br>setuid=root<br><br>webserver=yes<br>webserver-address=192.168.100.100<br>webserver-loglevel=detailed<br>webserver-port=8081<br><span class="hljs-comment"># webserver-allow-from指定允许访问webserver和API的IP白名单，多个IP可以使用英文逗号隔开</span><br>webserver-allow-from=192.168.100.0/24<br><span class="hljs-comment"># pdns服务监听的地址，多个IP可以使用英文逗号隔开</span><br>local-address=192.168.100.100<br>query-local-address=192.168.100.100<br></code></pre></div></td></tr></table></figure>

<h2 id="4-3-pdns-rec配置"><a href="#4-3-pdns-rec配置" class="headerlink" title="4.3 pdns-rec配置"></a>4.3 pdns-rec配置</h2><p>pdns-rec的配置文件除了默认文件命名和少数特殊的配置项外，其他的绝大部分配置都和pdns-auth一致，这里不作赘述。</p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">[root@tiny-cloud <span class="hljs-regexp">/etc/</span>pdns-recursor]<span class="hljs-comment"># realpath recursor.conf</span><br><span class="hljs-regexp">/etc/</span>pdns-recursor/recursor.conf<br></code></pre></div></td></tr></table></figure>



<h1 id="5、pdns日志处理"><a href="#5、pdns日志处理" class="headerlink" title="5、pdns日志处理"></a>5、pdns日志处理</h1><p>官网的相关文档可以点击<a target="_blank" rel="noopener" href="https://doc.powerdns.com/authoritative/running.html#logging-to-syslog">这里</a>查看，debug阶段我们把日志级别调到了最高的9，为了避免错过重要信息，我们把日志按照不同的级别分别写入不同的文件中。</p>
<p>修改centos对应的rsyslog配置文件并且重启服务</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># mkdir -p /etc/pdns/logs</span><br><br><span class="hljs-comment"># cat /etc/rsyslog.conf | grep pdns</span><br>local0.info                       /etc/pdns/logs/pdns.info.log<br>local0.warn                       /etc/pdns/logs/pdns.warn.log<br>local0.err                        /etc/pdns/logs/pdns.err.log<br><br>systemctl restart rsyslog.service<br></code></pre></div></td></tr></table></figure>

<p>修改pdns的<code>systemd</code>的<code>unit</code>文件，将里面的禁用<code>syslog</code>参数去掉，同时将其他多余的控制选项也一并去除，统一将各类参数设置集中到<code>pdns.conf</code>文件中，方便后期的管理和运维。</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">vim /usr/lib/systemd/system/pdns.service<br><br><span class="hljs-comment"># 将原来的启动参数全部替换掉</span><br><span class="hljs-comment"># ExecStart=/usr/sbin/pdns_server --socket-dir=%t/pdns --guardian=no --daemon=no --disable-syslog --log-timestamp=no --write-pid=no</span><br><span class="hljs-comment"># 替换为</span><br>ExecStart=/usr/sbin/pdns_server --socket-dir=%t/pdns<br><br>systemctl daemon-reload<br></code></pre></div></td></tr></table></figure>

<h1 id="6、pdns-auth的API请求"><a href="#6、pdns-auth的API请求" class="headerlink" title="6、pdns-auth的API请求"></a>6、pdns-auth的API请求</h1><p>PDNS提供了API功能，请求的时候需要注意正确携带配置中的<code>api-key</code>，否则会无法返回正确的结果，而是显示<code>401 Unauthorized</code>错误。</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ curl -v http://192.168.100.100:8081/api/v1/servers<br>*   Trying 192.168.100.100...<br>* TCP_NODELAY <span class="hljs-built_in">set</span><br>* Connected to 192.168.100.100 (192.168.100.100) port 8081 (<span class="hljs-comment">#0)</span><br>&gt; GET /api/v1/servers HTTP/1.1<br>&gt; Host: 192.168.100.100:8081<br>&gt; User-Agent: curl/7.61.1<br>&gt; Accept: */*<br>&gt;<br>&lt; HTTP/1.1 401 Unauthorized<br>&lt; Connection: close<br>&lt; Content-Length: 12<br>&lt; Content-Type: text/plain; charset=utf-8<br>&lt; Server: PowerDNS/4.4.0<br>&lt; Www-Authenticate: X-API-Key realm=<span class="hljs-string">&quot;PowerDNS&quot;</span><br>&lt;<br>* Closing connection 0<br>Unauthorized<br></code></pre></div></td></tr></table></figure>

<p>请求正确的情况下会返回<code>json</code>格式的信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ curl -v -H <span class="hljs-string">&#x27;X-API-Key: 配置中的api-key&#x27;</span> http://192.168.100.100:8081/api/v1/servers<br>*   Trying 192.168.100.100...<br>* TCP_NODELAY <span class="hljs-built_in">set</span><br>* Connected to 192.168.100.100 (192.168.100.100) port 8081 (<span class="hljs-comment">#0)</span><br>&gt; GET /api/v1/servers HTTP/1.1<br>&gt; Host: 192.168.100.100:8081<br>&gt; User-Agent: curl/7.61.1<br>&gt; Accept: */*<br>&gt; X-API-Key: 配置中的api-key<br>&gt;<br>&lt; HTTP/1.1 200 OK<br>&lt; Access-Control-Allow-Origin: *<br>&lt; Connection: close<br>&lt; Content-Length: 249<br>&lt; Content-Security-Policy: default-src <span class="hljs-string">&#x27;self&#x27;</span>; style-src <span class="hljs-string">&#x27;self&#x27;</span> <span class="hljs-string">&#x27;unsafe-inline&#x27;</span><br>&lt; Content-Type: application/json<br>&lt; Server: PowerDNS/4.4.0<br>&lt; X-Content-Type-Options: nosniff<br>&lt; X-Frame-Options: deny<br>&lt; X-Permitted-Cross-Domain-Policies: none<br>&lt; X-Xss-Protection: 1; mode=block<br>&lt;<br>* Closing connection 0<br>[&#123;<span class="hljs-string">&quot;config_url&quot;</span>: <span class="hljs-string">&quot;/api/v1/servers/localhost/config&#123;/config_setting&#125;&quot;</span>, <span class="hljs-string">&quot;daemon_type&quot;</span>: <span class="hljs-string">&quot;authoritative&quot;</span>, <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;Server&quot;</span>, <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;/api/v1/servers/localhost&quot;</span>, <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;4.4.0&quot;</span>, <span class="hljs-string">&quot;zones_url&quot;</span>: <span class="hljs-string">&quot;/api/v1/servers/localhost/zones&#123;/zone&#125;&quot;</span>&#125;]<br></code></pre></div></td></tr></table></figure>

<h1 id="7、DNS解析"><a href="#7、DNS解析" class="headerlink" title="7、DNS解析"></a>7、DNS解析</h1><p>对于pdns-rec而言，是单纯的一个递归查询器（Recursor），会根据设置的缓存时间来缓存向上查询到的DNS记录。</p>
<p>理论上PDNS Auth只会查询自己已有的DNS记录，如果不存在则会直接返回空，而不是继续向上递归查询。这里我们使用轻量型的DNS服务器dnsmasq作为对比，两者都没有手动添加任何的DNS解析记录。</p>
<p><img src="https://resource.tinychen.com/20210126165523.png" srcset="/img/loading.gif" lazyload></p>
<p>从上面的测试结果我们可以看出pdns auth只会返回自己的数据库中存在的记录。于是我们手动添加记录到pdns中再进行查询。</p>
<p>这里我们使用<code>pdnsutil</code>工具来简单测试，首先我们简单的创建一个关于example.org的zone，然后我们再创建关于example.org的一条A记录和MX记录，接着使用dig命令来进行测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ pdnsutil create-zone example.org ns1.example.com<br>Feb 24 16:54:48 gmysql Connection successful. Connected to database <span class="hljs-string">&#x27;powerdns&#x27;</span> on <span class="hljs-string">&#x27;localhost&#x27;</span>.<br>Feb 24 16:54:48 gmysql Connection successful. Connected to database <span class="hljs-string">&#x27;powerdns&#x27;</span> on <span class="hljs-string">&#x27;localhost&#x27;</span>.<br>Creating empty zone <span class="hljs-string">&#x27;example.org&#x27;</span><br>Feb 24 16:54:48 No serial <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;example.org&#x27;</span> found - zone is missing?<br>Also adding one NS record<br><br>$ pdnsutil list-all-zones<br>Feb 24 16:54:59 gmysql Connection successful. Connected to database <span class="hljs-string">&#x27;powerdns&#x27;</span> on <span class="hljs-string">&#x27;localhost&#x27;</span>.<br>Feb 24 16:54:59 gmysql Connection successful. Connected to database <span class="hljs-string">&#x27;powerdns&#x27;</span> on <span class="hljs-string">&#x27;localhost&#x27;</span>.<br>tinychen.com<br>example.org<br><br>$  pdnsutil add-record example.org <span class="hljs-string">&#x27;&#x27;</span> MX <span class="hljs-string">&#x27;25 mail.example.org&#x27;</span><br>Feb 24 16:55:36 gmysql Connection successful. Connected to database <span class="hljs-string">&#x27;powerdns&#x27;</span> on <span class="hljs-string">&#x27;localhost&#x27;</span>.<br>Feb 24 16:55:36 gmysql Connection successful. Connected to database <span class="hljs-string">&#x27;powerdns&#x27;</span> on <span class="hljs-string">&#x27;localhost&#x27;</span>.<br>New rrset:<br>example.org. 3600 IN MX 25 mail.example.org<br><br>$  pdnsutil add-record example.org. www A 192.168.100.100<br>Feb 24 16:56:09 gmysql Connection successful. Connected to database <span class="hljs-string">&#x27;powerdns&#x27;</span> on <span class="hljs-string">&#x27;localhost&#x27;</span>.<br>Feb 24 16:56:09 gmysql Connection successful. Connected to database <span class="hljs-string">&#x27;powerdns&#x27;</span> on <span class="hljs-string">&#x27;localhost&#x27;</span>.<br>New rrset:<br>www.example.org. 3600 IN A 192.168.100.100<br></code></pre></div></td></tr></table></figure>

<p><img src="https://resource.tinychen.com/20210224170528.png" srcset="/img/loading.gif" lazyload></p>
<p>同样的我们对tinychen.com进行相同的操作，可以看到这时已经能够解析出对应的IP了。</p>
<p><img src="https://resource.tinychen.com/20210224171337.png" srcset="/img/loading.gif" lazyload></p>
<p>从上图中我们可以看到对应的<code>tinychen.com</code>域名解析出来的记录是我们手动设定的IP值。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/loadbalance/">loadbalance</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/dns/">dns</a>
                    
                      <a class="hover-with-bg" href="/tags/powerdns/">powerdns</a>
                    
                  </div>
                
              </div>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/20210303-tomcat-start-guide/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">tomcat入门指北</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/20210105-prometheus-01-binary-install/">
                        <span class="hidden-mobile">Prometheus系列01-单机版二进制部署</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <i class="iconfont icon-copyright"></i> <a href="https://tinychen.com/" target="_blank" rel="nofollow noopener"><span>since 2017 By TinyChen </span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Hexo-Fluid</span></a> 
  </div>
  

  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        粤ICP备18140640号
      </a>
    </span>
    
  </div>


  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?7a96963a1145ac7fde1442d739a11ffd";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'UA-166769908-1', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
